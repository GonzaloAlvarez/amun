---
- name: Disable showing recent applications in the Dock
  community.general.osx_defaults:
    domain: com.apple.dock
    key: show-recents
    type: bool
    value: false

- name: Set the Dock's minimization effect to scale
  community.general.osx_defaults:
    domain: com.apple.dock
    key: mineffect
    type: string
    value: "scale"

- name: Disable launch animation for the Dock
  community.general.osx_defaults:
    domain: com.apple.dock
    key: launchanim
    type: bool
    value: "false"
    state: present

- name: Hide recent applications
  community.general.osx_defaults:
    domain: com.apple.dock
    key: show-recents
    type: bool
    value: false

- name: Check for dockutil in /usr/local/bin
  ansible.builtin.stat:
    path: /usr/local/bin/dockutil
  register: dockutil_local_bin

- name: Check for dockutil in /opt/homebrew/bin
  ansible.builtin.stat:
    path: /opt/homebrew/bin/dockutil
  register: dockutil_homebrew_bin

- name: Set dockutil_path fact
  ansible.builtin.set_fact:
    dockutil_path: "{{ '/usr/local/bin/dockutil' if dockutil_local_bin.stat.exists else ('/opt/homebrew/bin/dockutil' if dockutil_homebrew_bin.stat.exists else '') }}"


- name: Remove all dock content
  ansible.builtin.command: "{{ dockutil_path }} --remove all"
  changed_when: false

- name: Dock set content
  ansible.builtin.command: "{{ dockutil_path }} --add '{{ item }}'"
  changed_when: false
  loop:
    - "/System/Applications/Messages.app/"
    - "/Applications/Safari.app/"
    - "/Applications/iTerm.app/"
    - "/Applications/Firefox.app/"
  loop_control:
    pause: 5

- name: Restart the Dock to apply changes
  ansible.builtin.command: killall Dock
  changed_when: false
